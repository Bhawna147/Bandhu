{% extends 'base.html' %}

{% load static %}

{% block title %} Bandhu {% endblock %}

{% block style %}
<!-- Custom CSS -->
<link rel="stylesheet" href="{% static 'css/bandhu.css' %}">
<link rel="stylesheet" href="{% static 'vendor/css/bootstrap-select.min.css' %}">
{% endblock %}

{% block navbar-links %}
<li class="nav-item">
    <a class="nav-link px-3 px-lg-2" href="#about">About</a>
</li>
<!-- <li class="nav-item">
    <a class="nav-link px-3 px-lg-2" href="#mission">Mission</a>
</li> -->
<li class="nav-item dropdown">
    <a class="nav-link px-3 px-lg-2 dropdown-toggle" href="#mission">
      Mission
    </a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="#sanskar">Sanskar</a>
      <a class="dropdown-item" href="#swaraj">Swaraj</a>
      <a class="dropdown-item" href="#swabalamban">Swabalamban</a>
    </div>
  </li>
<li class="nav-item">
    <a class="nav-link px-3 px-lg-2" href="#recent-activities">Recents</a>
</li>
<li class="nav-item">
    <a class="nav-link px-3 px-lg-2" href="#gallery">Gallery</a>
</li>
<li class="nav-item">
    <a class="nav-link px-3 px-lg-2" href="#contact">Contact</a>
</li>
{% endblock %}

{% block showcase-title-container %}
<div class="slider-txt-container" style="padding: 205px 0 280px 0;">
    <p class="bold-txt mb-4" style="font-family: 'Raleway', sans-serif;">
        BANDHU
    </p>
    <p id="header-text" class="parallax-description font-weight-bold">
        <span class="d-block" lang="or" style="font-family: oriya;">ସବାଶେଷ  ମଣିଷର </span>
    </p>
    <!-- <p class="parallax-description pt-3" style="font-weight:500; font-family:cursive; text-transform: capitalize ;">
        Sanskar, Swaraj and Swabalamban
    </p> -->
</div>

{% endblock %}

{% block content %}

<!-- Recent Activities tab -->
<div class="recent-activities">
    <button class="btn btn-primary recent-activities-btn collapsed" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
        OnGoing/Recent Activities
        <i style="margin-left:10px !important;" class="fas fa-chevron-down"></i>
    </button>
    <div class="collapse recent-activities-collapse" id="collapseExample">
        <div class="card card-body recent-activity-card">
            <ol class="recent-activity-ol">
                {% for act in recent_activities %}
                    <a href="{{ act.link }}" style="font-size: 20px; text-decoration: none;">
                        <li class="recent-activity-li">
                            {{ act.title }}
                            <i style="font-size: 12px; float: right;">{{ act.date }}</i><br>
                            <p style="font-size: 13px;">{{ act.description|truncatechars:135 }}</p>
                        </li>
                    </a> 
                {% endfor %}
            </ol>
        </div>
    </div>

</div>


<!-- Initiatives Cards Section -->
<section id="initiatives" style="margin-top: -200px;">
    <div class="row justify-content-center initiatives mx-1">
        <div class="col-lg-20 col-md-4 col-sm-6 px-1">
            <div class="col-sm card mx-auto" >
                <img src="{{ initiatives.ankurayan_thumb.url }}" class="rounded-top card-img-top">
                <div class="card-body p-3">
                    <h5 class="card-title content-title font-weight-bolder" style="text-align: center;">Ankurayan</h5>
                    <p class="content-description">
                        {{ initiatives.ankurayan_desc }}
                    </p>
                </div>
                {% now 'Y' as current_year %}
                <a href="{% url 'ankurayan:AnkurayanDetail' current_year %}" class="stretched-link"></a>
            </div>
        </div>
        <div class="col-lg-20 col-md-4 col-sm-6 px-1">
            <div class="col-sm card  mx-auto" >
                <img src="{{ initiatives.kendra_thumb.url }}" class="rounded-top">
                <div class="card-body p-3">
                    <h5 class="card-title content-title font-weight-bolder">Ananda Kendra</h5>
                    <p class="content-description">
                        {{ initiatives.kendra_desc }}
                    </p>
                </div>
                <a href="{% url 'anandakendra:anandakendra' %}" class="stretched-link"></a>
            </div>
        </div>
        <div class="col-lg-20 col-md-4 col-sm-6 px-1">
            <div class="col-sm card  mx-auto" >
                <img src="{{ initiatives.bandhughar_thumb.url }}" class="rounded-top">
                <div class="card-body p-3">
                    <h5 class="card-title content-title font-weight-bolder">Bandhu Ghar</h5>
                    <p class="content-description">
                        {{ initiatives.bandhughar_desc }}
                    </p>
                </div>
                <a href="{% url 'ashram:ashram' %}" class="stretched-link"></a>
            </div>
        </div>
        <div class="col-lg-20 col-md-4 col-sm-6 px-1">
            <div class="col-sm card  mx-auto" >
                <img src="{{ initiatives.otheract_thumb.url }}" class="rounded-top">
                <div class="card-body p-3">
                    <h5 class="card-title content-title font-weight-bolder">Other Activities</h5>
                    <p class="content-description">
                        {{ initiatives.otheract_desc }}
                    </p>
                </div>
                <a href="{% url 'charitywork:charity_work' %}" class="stretched-link"></a>
            </div>
        </div>
        <div class="col-lg-20 col-md-4 col-sm-6 px-1">
            <div class="col-sm card  mx-auto" >
                <img src="{{ initiatives.publications_thumb.url }}" class="rounded-top">
                <div class="card-body p-3">
                    <h5 class="card-title content-title font-weight-bolder">Our Publications</h5>
                    <p class="content-description">
                        {{ initiatives.publications_desc }}
                    </p>
                </div>
                <a href="{% url 'publications:index' %}" class="stretched-link"></a>
            </div>
        </div>
    </div>
</section>
<!-- Initiatives Cards Section Ends -->

<!-- About secion -->
<section id="about" class="mb-4">
    <h3 class="section-title mt-5 pt-3">About Us</h3>
    <div class="container">
        <div class="content-box mt-4 text-center">
            <p style="font-size: 20px;">
                <strong>{{ about.tagline }}</strong>
            </p>
            <p style="font-size: 18px;">
                {{ about.desc }}
            </p>
        </div>
    </div>
</section>

<!-- Mission Section -->
<section id="mission">
    <h3 class="section-title mt-5 pt-3 pt-sm-0">Our Mission</h3>
    <div class="container">
        <div class="section-content">
            <!-- SANSKAR -->
            <div id="sanskar">
                <div class="row justify-content-center mb-5">
                    <h3 class="content-title d-md-none mb-4">Sanskar</h3>
                    <div class="col-md-5 col-lg-4 align-self-center">
                        <div id="sanskar-carousel" class="carousel slide m-auto" data-ride="carousel">
                            <ul class="carousel-indicators">
                                {% for img in mission.sanskarcarousel_set.all %}
                                <li data-target="#sanskar-carousel" data-slide-to="{{ forloop.counter0 }}" 
                                    class="{% if forloop.counter == 1 %}active{% endif %}"></li>
                                {% endfor %}
                            </ul>
                            <div class="carousel-inner">
                                {% for img in mission.sanskarcarousel_set.all %}
                                <div class="carousel-item {% if forloop.counter == 1 %}active{% endif %}">
                                    <img src="{{ img.picture.url }}" alt="carousel image">
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="content-box col-md-7 col-lg-8 mt-4">
                        <h3 class="content-title d-none d-md-block">Sanskar</h3>
                        <p>
                            <strong>
                                {{ mission.sanskar_tagline }}
                            </strong>
                        </p>
                        <p>
                            {{ mission.sanskar_desc }}
                        </p>
                    </div>
                </div>
            </div>
            <!-- SWARAJ -->
            <div id="swaraj">
                <div class="row justify-content-center mb-5">
                    <h3 class="content-title d-md-none mb-4">Swaraj</h3>
                    <div class="col-md-5 col-lg-4 align-self-center">
                        <div id="swaraj-carousel" class="carousel slide m-auto" data-ride="carousel">
                            <ul class="carousel-indicators">
                                {% for img in mission.swarajcarousel_set.all %}
                                <li data-target="#swaraj-carousel" data-slide-to="{{ forloop.counter0 }}" 
                                    class="{% if forloop.counter == 1 %}active{% endif %}"></li>
                                {% endfor %}
                            </ul>
                            <div class="carousel-inner">
                                {% for img in mission.swarajcarousel_set.all %}
                                <div class="carousel-item {% if forloop.counter == 1 %}active{% endif %}">
                                    <img src="{{ img.picture.url }}" alt="carousel image">
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <div class="content-box col-md-7 col-lg-8 mt-4 order-md-first">

                        <h3 class="content-title d-none d-md-block">Swaraj</h3>
                        <p>
                            <strong>
                                {{ mission.swaraj_tagline }}
                            </strong>
                        </p>
                        <p>
                            {{ mission.swaraj_desc }}
                        </p>
                    </div>
                </div>
            </div>
            <!-- SWABALAMBAN -->
            <div id="swabalamban">
                <div class="row justify-content-center mb-5">
                    <h3 class="content-title d-md-none mb-4">Swabalamban</h3>
                    <div class="col-md-5 col-lg-4 align-self-center">
                        <div id="swabalamban-carousel" class="carousel slide m-auto" data-ride="carousel">
                            <ul class="carousel-indicators">
                                {% for img in mission.swabalambancarousel_set.all %}
                                <li data-target="#swabalamban-carousel" data-slide-to="{{ forloop.counter0 }}" 
                                    class="{% if forloop.counter == 1 %}active{% endif %}"></li>
                                {% endfor %}
                            </ul>
                            <div class="carousel-inner">
                                {% for img in mission.swabalambancarousel_set.all %}
                                <div class="carousel-item {% if forloop.counter == 1 %}active{% endif %}">
                                    <img src="{{ img.picture.url }}" alt="carousel image">
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="content-box col-md-7 col-lg-8 mt-4">
                        <h3 class="content-title d-none d-md-block">Swabalamban</h3>
                        <p>
                            <strong>
                                {{ mission.swaraj_tagline }}
                            </strong>
                        </p>
                        <p>
                            {{ mission.swaraj_desc }}
                        </p>
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>
<!-- About Section Ends -->
<!-- Recent Activities Section -->
<section id="recent-activities">
    <div class="bg-grey" style="padding: 50px 0;">
        <div class="container">
            <div class="row">
                <div class="section-content w-100">
                    <div class="content-box from-bottom delay-200">
                        <h3 class="section-title">Recent Activities</h3>
                        <div class="glide">
                            <div class="glide__track" data-glide-el="track">
                                <ul class="glide__slides">
                                    {% for event in recent_events %}
                                    <li class="glide__slide">
                                        <div class="card w-100 shadow-sm border border-primary border-rounded mx-auto my-2">
                                            <img src="{{ event.thumb.url }}" class="card-img-top home-card-img" alt=""  width="300px">
                                            <div class="card-body pb-0">
                                                <h5 class="card-title font-weight-bold">{{ event.name }}</h5>
                                                <p class="mb-3">
                                                    {{ event.kendra }}{{ event.category.ankurayan }}{{ event.ashram }}{{ event.charity }}
                                                <br>
                                                </p>
                                                <a href="#" class="stretched-link" data-target="#recent-modal{{forloop.counter0}}" data-toggle="modal"></a>
                                            </div>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                                <div class="glide__arrows disable_arrows d-none d-md-block" data-glide-el="controls">
                                <button class="slider_arrow slider_arrow--prev glide__arrow glide__arrow--left" data-glide-dir="<">
                                    <i class="fas fa-arrow-circle-left"></i>
                                </button>
                                <button class="slider_arrow slider_arrow--next glide__arrow glide__arrow--right" data-glide-dir=">">
                                    <i class="fas fa-arrow-circle-right"></i>
                                </button>
                            </div>
                            <div class="glide__bullets" data-glide-el="controls[nav]">
                                {% for event in recent_events %}
                                <button class="glide__bullet" data-glide-dir="={{ forloop.counter0 }}"></button>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- MODAL -->
{% for event in recent_events %}
<div class="modal fade bd-example-modal-lg" tabindex="-1" id="recent-modal{{forloop.counter0}}" role="dialog"
aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title bld" id="exampleModalLongTitle">{{event.name}}</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="row">
                <div class="col-md-6 align-self-center">
                    <div id="event{{ forloop.count0 }}-carousel" class="carousel slide m-auto" data-ride="carousel">
                        <ul class="carousel-indicators">
                            <li data-target="#event{{ forloop.count0 }}-carousel" data-slide-to="0" class=""></li>
                            <li data-target="#event{{ forloop.count0 }}-carousel" data-slide-to="1" class=""></li>
                            <li data-target="#event{{ forloop.count0 }}-carousel" data-slide-to="2" class="active"></li>
                        </ul>
                        <div class="carousel-inner">
                            <div class="carousel-item">
                                <img src="/static/img/pimg6.jpg" alt="carousel image" class="w-100">
                            </div>
                            <div class="carousel-item">
                                <img src="/static/img/pimg2.jpg" alt="carousel image" class="w-100">
                            </div>
                            <div class="carousel-item active">
                                <img src="/static/img/pimg3.jpg" alt="carousel image" class="w-100">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h3 class="font-weight-bolder">Description</h3>
                    {{ event.description }}
                </div>
            </div>
            
        </div>
    </div>
</div>
</div>
{% endfor %}

<!-- Recent Activities Section Ends -->
<!-- Volunteer Section -->
<section id="volunteer">
    <div class="parallax-style text-white text-center">
        <div class="parallax-overlay dark-overlay section-padding" style="padding: 80px 0 70px;">
            <div class="container">
                <div class="section-head" style="margin-bottom:60px;">
                    <h3 class="section-title parallax-title" style="word-spacing: 5px;">
                        {{ volunteer.title }}
                    </h3>
                </div>

                <div class="row justify-content-center">
                    <p class="parallax-description w-100 px-3" style="font-size:1.7em; line-height:35px; margin-bottom: 30px;">
                        {{ volunteer.tagline }}
                    </p>
                    <button type="button" class="btn btn-outline-light py-2 px-4 custom-btn angle-effect">
                        <a href="{% url 'signup' %}" class="d-block text-decoration-none text-white">Join Now</a>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Volunteer Section End-->

<section id="gallery">
    <div class="bg-grey" style="padding: 80px 0 60px;">
        <div class="container">
            <div class="section-head">
                <h2 class="section-title">
                    Gallery
                </h2>
                <p class="section-description">
                    {{ gallery.tagline }}
                </p>
            </div>

            <div id="gallery-container" class="gallery-container">
                <div class="galleryFilter">
                    <a href="#" data-filter="" class="current">All</a>
                    <a href="#" data-filter=".ankurayan">Ankurayan</a>
                    <a href="#" data-filter=".anandakendra">Ananda Kendra</a>
                    <a href="#" data-filter=".bandhughar">Bandhu Ghar</a>
                    <a href="#" data-filter=".other">Other Activities</a>
                </div>

                <div class="gallery-item element-from-bottom clearfix">
                    {% for photo in photos %}
                    <figure class="item {{ photo.tags }}">
                        <img src='{{ photo.picture.url }}' alt="Photo" data-rel="photoSwipe">
                        <a href="javascript:pswpInit({{ forloop.counter0 }})" class="stretched-link">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </figure>
                    {% endfor %}
                    <figure id="load-more" class="item ankurayan anandakendra bandhughar other">
                        <img alt="Photo">
                        <a href="javascript:void(0);" class="stretched-link">
                            <p class="text-center">Show More</p>
                        </a>
                    </figure>
                </div>
            </div>
            {% if user.is_admin %}
            <div class="row justify-content-center mt-4">
                <div class="col col-sm-5 add-images text-center">
                    <button type="button" class="btn btn-outline-primary" data-toggle="modal"
                        data-target="#addToGallery">
                        Upload Image
                    </button>
                    <div class="modal fade bd-example-modal-lg" tabindex="-1" id="addToGallery" role="dialog"
                        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title bld" id="exampleModalLongTitle">Upload Images</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form method="POST" enctype="multipart/form-data" name="imageUploadForm"
                                            action="{% url 'add_images' %}" onsubmit="return imageValidation()">
                                        {% csrf_token %}
                                        <label class="left-label bld" for="">Image</label>
                                        <div class="input-group">
                                            <div class="custom-file">
                                                <input type="file" class="custom-file-input"
                                                    name="image" id="inputGroupFile04"
                                                    aria-describedby="inputGroupFileAddon04">
                                                <label class="custom-file-label" for="inputGroupFile04">Add
                                                    Image</label>
                                            </div>
                                        </div><br>
                                        <label class="left-label bld" for="">Caption</label>
                                        <textarea class="form-control" name="caption" rows="3"
                                            placeholder="Caption for image (optional)"></textarea><br>
                                        <label class="left-label bld" for="tags-select">Tags</label>
                                        <select id="tags-select" class="form-control selectpicker" name="tags" multiple>
                                            <option value="ankurayan">Ankurayan</option>
                                            <option value="anandakendra">Ananda Kendra</option>
                                            <option value="bandhughar">Bandhu Ghar</option>
                                            <option value="other">Other Activities</option>
                                        </select><br>
                                        <button class="btn btn-primary w-50 mt-4">Submit</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- <div class="col col-sm-5 approve-images text-center">
                    <button type="button" class="btn btn-outline-primary" data-toggle="modal"
                        data-target="#deleteImages">
                        Delete Images
                    </button>
                </div> -->
            </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- Include PhotoSwipe -->
{% include 'snippets/init_pswp.html' %}

<!-- Scroll To Top Button -->
<div id="scroll-to-top">
    <div class="hex scroll-top">
        <span><i class="fa fa-arrow-up"></i></span>
    </div>
</div>

{% endblock %}


{% block scripts %}<!-- PHOTOSWIPE -->
<script>
    // build the json album images collection 
    window.djangoAlbumImages = [
        {% for photo in photos %}
            {
                src: '{{ photo.picture.url }}',
                w:  {{ photo.picture.width }},
                h:  {{ photo.picture.height }},
                title: '{{ photo.caption }}',
            },
        {% endfor %}
    ];

    // Change album on filtering images
    $('#gallery-container .galleryFilter a').on("click", function () {
        let filter = $(this).data('filter');

        if (filter == "") {
            window.djangoAlbumImages = [
                {% for photo in photos %}
                    {
                        src: '{{ photo.picture.url }}',
                        w: {{ photo.picture.width }},
                        h: {{ photo.picture.height }},
                        title: '{{ photo.caption }}',
                    },
                {% endfor %}
            ];

            $('#gallery-container .gallery-item a').each(function (index, img) {
                if ($(img).closest('#load-more').length == 0) $(img).attr("href", 'javascript:pswpInit(' + index + ')');
            });
        }
        else {
            section = filter.slice(1);

            window.djangoAlbumImages = [];

            {% for photo in photos %}
            if ("{{ photo.tags }}".includes(section)) {
                window.djangoAlbumImages.push(
                    {
                        src: '{{ photo.picture.url }}',
                        w: {{ photo.picture.width }},
                        h: {{ photo.picture.height }},
                        title: '{{ photo.caption }}',
                    }
                );
            }
            {% endfor %}

            let selector = '#gallery-container ' + filter + ' a';
            $(selector).each(function (index, img) {
                if ($(img).closest('#load-more').length == 0) $(img).attr("href", 'javascript:pswpInit(' + index + ')');
            });
        }

    });
</script>
<!-- Custom JS -->
<script src="{% static 'js/bandhu.js' %}"></script>
<script src="{% static 'vendor/js/bootstrap-select.min.js' %}"></script>
<!-- Contact Scrollspy Problem -->
<script>contact_scrollspy()</script>
<!-- Change name of image input -->
<script>
    $(".custom-file-input").on("change", function() {
      var fileName = $(this).val().split("\\").pop();
      $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
    });
</script>
<!-- Instantiate Bootstrap Select -->
<script>$('#tags-select').selectpicker();</script>
<!-- Image Validation -->
<script>
    function imageValidation() {
        var imageInput = document.forms["imageUploadForm"]["image"];
        var image = imageInput.value;
        console.log(image)
        var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.gif)$/i; 
            
        if (!allowedExtensions.exec(image)) { 
            alert('Invalid file type');
            imageInput.nextElementSibling.classList.remove("selected");
            imageInput.nextElementSibling.innerHTML = "Add Image";
            return false; 
        }
    }
</script>
<!-- RECENT ACTIVITIES CAROUSEL -->
<script>
    var glide = new Glide('.glide',{
        type: 'carousel',
        focusAt: 'center',
        perView: 3,
        autoplay: 2000,
        gap: 30,
        breakpoints: {
            991: {
                perView: 2,
            },
            767: {
                perView: 1,
            },
        }
    })

    glide.mount()
</script>
{% endblock %}